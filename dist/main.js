(()=>{"use strict";const t="images/avatar.jpg";var e=document.querySelector("#card-template").content;function n(t,n,o,r,c,a,i,u,l){var s=e.cloneNode(!0);s.querySelector(".places__item").setAttribute("data-card-id",r);var p=s.querySelector(".card__image"),d=s.querySelector(".card__like-count"),_=s.querySelector(".card__like-button"),m=s.querySelector(".card__delete-button");return console.log(c,a),c===a?(m.classList.add("card__delete-button_visible"),m.addEventListener("click",i)):m.style.display="none",p.src=n,p.alt=t,d.textContent=o.length,o.some((function(t){return t._id===a}))&&_.classList.add("card__like-button_is-active"),s.querySelector(".card__title").textContent=t,_.addEventListener("click",u),p.addEventListener("click",(function(){return l(t,n)})),s}var o="https://around.nomoreparties.co/v1/wff-cohort-8",r={authorization:"cb8b3077-1336-4493-90d8-81527940728d","Content-Type":"application/json"};function c(t,e,n){var o=n.querySelector("#".concat(t.name,"-error"));t.setCustomValidity(""),t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage||"Некорректный ввод."):t.validity.typeMismatch?t.setCustomValidity("Введите адрес сайта."):t.validity.valueMissing?t.setCustomValidity("Вы пропустили это поле."):t.setCustomValidity(""),t.validity.valid?a(t,o,e):function(t,e,n,o){t.classList.add(o.inputErrorClass),e.textContent=n,e.classList.add(o.errorClass),console.log(t,e,n)}(t,o,t.validationMessage,e)}function a(t,e,n){console.log("hide"),t.classList.remove(n.inputErrorClass),e.classList.remove(n.errorClass),e.textContent=""}function i(t,e,n){t.some((function(t){return!t.validity.valid}))?(e.classList.add(n.inactiveButtonClass),e.disabled=!0):(e.classList.remove(n.inactiveButtonClass),e.disabled=!1)}function u(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(e.submitButtonSelector);n.forEach((function(n){a(t,n,e)})),i(n,o,e)}function l(t){Array.from(document.querySelectorAll(t.formSelector)).forEach((function(e){e.addEventListener("submit",(function(t){t.preventDefault()})),function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(e.submitButtonSelector);n.forEach((function(r){r.addEventListener("input",(function(){c(r,e,t),i(n,o,e)}))})),i(n,o,e)}(e,t)}))}function s(t,e){e?(t.classList.add("popup_is-opened"),document.addEventListener("keydown",p)):(t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",p))}function p(t){if("Escape"===t.key){var e=document.querySelector(".popup_is-opened");e&&s(e,!1)}}function d(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}document.addEventListener("DOMContentLoaded",(function(){var e,a,p=document.querySelector(".popup_type_edit"),_=document.querySelector(".popup_type_new-card"),m=document.querySelector(".profile__edit-button"),f=document.querySelector(".profile__add-button"),y=document.querySelector(".profile__title"),v=document.querySelector(".profile__description"),S=document.querySelectorAll(".popup__close"),h=document.querySelector(".places__list"),b=p.querySelector("form"),g=document.querySelector('.popup__form[name="new-place"]'),C=document.querySelector(".popup_type_image"),k=C.querySelector(".popup__image"),q=C.querySelector(".popup__caption"),E=new Image,L=document.querySelector('.popup__form[name="edit_avatar"]'),j={};function x(t){var e=t.target.closest(".places__item"),n=e.getAttribute("data-card-id");n?function(t){return localStorage.getItem("token"),console.log(t),fetch("".concat(o,"/cards/").concat(t),{method:"DELETE",headers:r}).then((function(t){return console.log("Ответ сервера:",t),t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}(n).then((function(){e.remove()})).catch((function(t){console.error("Ошибка при удалении карточки:",t)})):console.error("Не найден ID карточки.")}e=document.querySelector(".avatar__edit-button"),a=document.querySelector(".popup_type_edit_avatar"),e.addEventListener("click",(function(){s(a,!0)}));var A={formSelector:'.popup__form[name="edit-profile"]',inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},P={formSelector:'.popup__form[name="new-place"]',inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function w(t){s(t.currentTarget.closest(".popup"),!1)}function T(t){var e,n=t.target.closest(".places__item"),c=n.querySelector(".card__like-button"),a=n.querySelector(".card__like-count"),i=n.getAttribute("data-card-id");(c.classList.contains("card__like-button_is-active")?(e=i,console.log(e),fetch("".concat(o,"/cards/likes/").concat(e),{method:"DELETE",headers:r}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))):function(t){return console.log(t),fetch("".concat(o,"/cards/likes/").concat(t),{method:"PUT",headers:r}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}(i)).then((function(t){c.classList.toggle("card__like-button_is-active"),a.textContent=t.likes.length})).catch((function(t){console.error("Ошибка при изменении статуса лайка:",t)}))}function B(t,e){k.src=e,k.alt=t,q.textContent=t,s(C,!0)}l({formSelector:'.popup__form[name="edit_avatar"]',inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"}),l(A),l(P),L.addEventListener("submit",(function(t){t.preventDefault();var e,n=L.querySelector(".popup__button"),c=n.textContent;n.textContent="Сохранение...",(e=L.elements.link.value,fetch("".concat(o,"/users/me/avatar"),{method:"PATCH",headers:r,body:JSON.stringify({avatar:e})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))).then((function(t){document.querySelector(".profile__image").style.backgroundImage="url('".concat(t.avatar,"')"),s(document.querySelector(".popup_type_edit_avatar"),!1)})).catch((function(t){console.error("Ошибка при обновлении аватара:",t)})).finally((function(){setTimeout((function(){n.textContent=c}),500)}))})),E.src=t,document.querySelector(".profile__image").style.backgroundImage="url('".concat(t,"')"),g.addEventListener("submit",(function(t){t.preventDefault();var e,c,a=t.target,i=a.querySelector(".popup__button"),u=i.textContent;i.textContent="Добавление...",(e=a.elements["place-name"].value,c=a.elements.link.value,localStorage.getItem("token"),fetch("".concat(o,"/cards"),{method:"POST",headers:r,body:JSON.stringify({name:e,link:c})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))).then((function(t){var e=n(t.name,t.link,t.likes,t._id,j.id,t.owner._id,x,T,B);h.prepend(e),a.reset(),s(_,!1)})).catch((function(t){console.error("Ошибка при добавлении карточки:",t)})).finally((function(){setTimeout((function(){i.textContent=u}),500)}))})),S.forEach((function(t){t.addEventListener("click",w)})),b.addEventListener("submit",(function(t){t.preventDefault();var e,n,c=t.target,a=c.elements,i=a.name,u=a.description,l=c.querySelector(".popup__button"),d=l.textContent;l.textContent="Сохранение...",(e=i.value,n=u.value,fetch("".concat(o,"/users/me"),{method:"PATCH",headers:r,body:JSON.stringify({name:e,about:n})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))).then((function(t){y.textContent=t.name,v.textContent=t.about,setTimeout((function(){l.textContent=d,s(p,!1)}),500)})).catch((function(t){console.error("Ошибка обновления профиля:",t)}))})),document.addEventListener("click",(function(t){t.target.classList.contains("popup")&&s(t.target,!1),t.target.closest(".popup__content")&&t.stopPropagation()})),f.addEventListener("click",(function(){u(g,P),s(_,!0)})),m.addEventListener("click",(function(){var t=b.elements,e=t.name,n=t.description;e.value=y.textContent,n.value=v.textContent,u(b,A);var o=Array.from(b.querySelectorAll(A.inputSelector));o.forEach((function(t){c(t,A,b)})),i(o,b.querySelector(A.submitButtonSelector),A),s(p,!0)})),Promise.all([fetch("".concat(o,"/users/me"),{headers:r}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})),fetch("".concat(o,"/cards"),{headers:r}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))]).then((function(t){var e,o,r=(o=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var o,r,c,a,i=[],u=!0,l=!1;try{if(c=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(o=c.call(n)).done)&&(i.push(o.value),i.length!==e);u=!0);}catch(t){l=!0,r=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw r}}return i}}(e,o)||function(t,e){if(t){if("string"==typeof t)return d(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?d(t,e):void 0}}(e,o)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),c=r[0],a=r[1];j.id=c._id,y.textContent=c.name,v.textContent=c.about,document.querySelector(".profile__image").style.backgroundImage="url('".concat(c.avatar,"')");var i=c._id;a.forEach((function(t){var e=n(t.name,t.link,t.likes,t._id,t.owner._id,i,x,T,B);h.appendChild(e)}))})).catch((function(t){console.error("Ошибка при получении данных:",t)}))}))})();